<?php
//
class ESSBAddonsHelper {

	private $cache_options_slug = "essb3_addons";
	private $announced_addons_slug = "essb3_addons_announce";
	private $update_addons_server = "http://extensions.appscreo.com/4/"; //"http://addons.appscreo.com";

	private $base_addons = 'eyJlc3NiLWZ1bmN0aW9uYWwtYnV0dG9ucy1wYWNrIjp7InNsdWciOiJlc3NiLWZ1bmN0aW9uYWwtYnV0dG9ucy1wYWNrIiwibmFtZSI6IlNvY2lhbCBOZXR3b3JrczogRnVuY3Rpb25hbCBTaGFyZSBCdXR0b25zIFBhY2siLCJpbWFnZSI6Imh0dHA6XC9cL2FkZG9ucy5hcHBzY3Jlby5jb21cL2lcL2FkZG9uX2ltYWdlcy1wb3NpdGlvbi5wbmciLCJkZXNjcmlwdGlvbiI6IkluY2x1ZGUgdXNhZ2Ugb2YgZnVuY3Rpb25hbCBidXR0b25zIHNldDogUHJldmlvdXMgUG9zdCwgTmV4dCBQb3N0LCBDb3B5IExpbmssIEJvb2ttYXJrLCBRUiBDb2RlIEdlbmVyYXRvciIsInByaWNlIjoiRlJFRSIsInBhZ2UiOiJodHRwOlwvXC9nZXQuc29jaWFsc2hhcmluZ3BsdWdpbi5jb21cLz9kb3dubG9hZD1lc3NiLWZ1bmNpdG9uYWwtYnV0dG9ucy1wYWNrIiwiZGVtb191cmwiOiIiLCJjaGVjayI6IkVTU0JfRlBfUk9PVCIsInRhZ3MiOiJuZXciLCJjYXRlZ29yeSI6InNvY2lhbCBuZXR3b3JrcyIsInJlcXVpcmVzIjoiNC4xLjgiLCJmaWx0ZXJzIjoibmV0d29ya3MsbmV3LGZyZWUifSwiZXNzYi1vcHRpbi1mbHlvdXQiOnsic2x1ZyI6ImVzc2Itb3B0aW4tZmx5b3V0IiwibmFtZSI6Ik9wdC1pbiBGbHlvdXQgQWRkLW9uIGZvciBFYXN5IFNvY2lhbCBTaGFyZSBCdXR0b25zIiwiaW1hZ2UiOiJodHRwOlwvXC9hZGRvbnMuYXBwc2NyZW8uY29tXC9pXC9hZGRvbl9pbWFnZXMtc3Vic2NyaWJlLnBuZyIsImRlc2NyaXB0aW9uIjoiRGlzcGxheSBmbHlvdXQgb3B0LWluIGZvcm1zIGJhc2VkIG9uIHZhcmlvdXMgY29uZGl0aW9uczogdGltZSBkZWxheSwgc2Nyb2xsIG9yIGV4aXQgaW50ZW50IGFuZCBpbmNyZWFzZSB5b3VyIHN1YnNjcmliZXJzLiIsInByaWNlIjoiRlJFRSIsInBhZ2UiOiJodHRwOlwvXC9nZXQuc29jaWFsc2hhcmluZ3BsdWdpbi5jb21cLz9kb3dubG9hZD1lc3NiLW9wdGluLWZseW91dCIsImRlbW9fdXJsIjoiIiwiY2hlY2siOiJFU1NCM19PRk9GX1ZFUlNJT04iLCJ0YWdzIjoibmV3IiwiY2F0ZWdvcnkiOiJzdWJzY3JpYmUgZXh0ZW5zaW9uIiwicmVxdWlyZXMiOiI0LjAuMyIsImZpbHRlcnMiOiJzdWJzY3JpYmUsbmV3LGZyZWUifSwiZXNzYi1iZWF2ZXJidWlsZGVyLXRoZW1lLWludGVncmF0aW9uIjp7InNsdWciOiJlc3NiLWJlYXZlcmJ1aWxkZXItdGhlbWUtaW50ZWdyYXRpb24iLCJuYW1lIjoiRGlzcGxheSBNZXRob2Q6IEJlYXZlciBCdWlsZGVyIFRoZW1lIEludGVncmF0aW9uIiwiaW1hZ2UiOiJodHRwOlwvXC9hZGRvbnMuYXBwc2NyZW8uY29tXC9pXC9hZGRvbl9pbWFnZXMtcG9zaXRpb24ucG5nIiwiZGVzY3JpcHRpb24iOiJDdXN0b20gZGlzcGxheSBwb3NpdGlvbnMgZm9yIEJlYXZlciBCdWlsZGVyIFRoZW1lOiBCZWZvcmVcL0FmdGVyIGNvbnRlbnQiLCJwcmljZSI6IkZSRUUiLCJwYWdlIjoiaHR0cDpcL1wvZ2V0LnNvY2lhbHNoYXJpbmdwbHVnaW4uY29tXC8/ZG93bmxvYWQ9ZXNzYi1iZWF2ZXJidWlsZGVyLXRoZW1lLWludGVncmF0aW9uIiwiZGVtb191cmwiOiIiLCJjaGVjayI6IkVTU0JfQkJUX0NVU1RPTV9CT0lMRVJQTEFURSIsInRhZ3MiOiJuZXciLCJjYXRlZ29yeSI6ImRpc3BsYXkgbWV0aG9kIiwicmVxdWlyZXMiOiI0LjAuMiIsImZpbHRlcnMiOiJkaXNwbGF5LG5ldyxmcmVlIn0sImVzc2ItdmlkZW8tc2hhcmUtZXZlbnRzIjp7InNsdWciOiJlc3NiLXZpZGVvLXNoYXJlLWV2ZW50cyIsIm5hbWUiOiJWaWRlbyBTaGFyaW5nIEFkZC1vbiBmb3IgRWFzeSBTb2NpYWwgU2hhcmUgQnV0dG9ucyIsImltYWdlIjoiaHR0cDpcL1wvYWRkb25zLmFwcHNjcmVvLmNvbVwvaVwvYWRkb25faW1hZ2VzNC0xMS5wbmciLCJkZXNjcmlwdGlvbiI6IkEgbXVzdCBoYXZlIHRvb2wgZm9yIGVhY2ggdmlkZW8gbWFya2V0aW5nIGNhbXBhaWduLiBBZGQgYmVhdXRpZnVsIGNhbGwgdG8gYWN0aW9ucyBvbiBzcGVjaWZpYyBldmVudHMgdG8gaW5jcmVhc2UgeW91ciBzb2NpYWwgc2hhcmVzLCBzb2NpYWwgZm9sbG93aW5nLCBtYWlsaW5nIGxpc3QsIHlvdXIgbWFya2V0aW5nIG1lc3NhZ2UgYXQgdGhlIHJpZ2h0IHRpbWUgb3IganVzdCBzaGFyZSBidXR0b25zLiIsInByaWNlIjoiJDE0IiwicGFnZSI6Imh0dHBzOlwvXC9jb2RlY2FueW9uLm5ldFwvaXRlbVwvdmlkZW8tc2hhcmluZy1hZGRvbi1mb3ItZWFzeS1zb2NpYWwtc2hhcmUtYnV0dG9uc1wvODQzNDQ2NyIsImRlbW9fdXJsIjoiaHR0cDpcL1wvcHJldmlldy5jb2RlY2FueW9uLm5ldFwvaXRlbVwvdmlkZW8tc2hhcmluZy1hZGRvbi1mb3ItZWFzeS1zb2NpYWwtc2hhcmUtYnV0dG9uc1wvZnVsbF9zY3JlZW5fcHJldmlld1wvODQzNDQ2NyIsImNoZWNrIjoiRVNTQjNfVlNFX1ZFUlNJT04iLCJ0YWdzIjoiIiwiY2F0ZWdvcnkiOiJ2aWRlbyBzaGFyaW5nIiwicmVxdWlyZXMiOiI0LjAiLCJmaWx0ZXJzIjoidmlkZW8sZnVuY3Rpb24scGFpZCJ9LCJlc3NiLW9wdGluLWJvb3N0ZXIiOnsic2x1ZyI6ImVzc2Itb3B0aW4tYm9vc3RlciIsIm5hbWUiOiJPcHQtaW4gQm9vc3RlciBBZGQtb24gZm9yIEVhc3kgU29jaWFsIFNoYXJlIEJ1dHRvbnMiLCJpbWFnZSI6Imh0dHA6XC9cL2FkZG9ucy5hcHBzY3Jlby5jb21cL2lcL2FkZG9uX2ltYWdlcy1zdWJzY3JpYmUucG5nIiwiZGVzY3JpcHRpb24iOiJEaXNwbGF5IG9wdC1pbiBmb3JtcyBiYXNlZCBvbiB2YXJpb3VzIGNvbmRpdGlvbnM6IHRpbWUgZGVsYXksIHNjcm9sbCBvciBleGl0IGludGVudCBhbmQgaW5jcmVhc2UgeW91ciBzdWJzY3JpYmVycy4iLCJwcmljZSI6IkZSRUUiLCJwYWdlIjoiaHR0cDpcL1wvZ2V0LnNvY2lhbHNoYXJpbmdwbHVnaW4uY29tXC8/ZG93bmxvYWQ9ZXNzYi1vcHRpbi1ib29zdGVyIiwiZGVtb191cmwiOiIiLCJjaGVjayI6IkVTU0IzX09GT0JfVkVSU0lPTiIsInRhZ3MiOiIiLCJjYXRlZ29yeSI6InN1YnNjcmliZSBleHRlbnNpb24iLCJyZXF1aXJlcyI6IjQuMC4zIiwiZmlsdGVycyI6InN1YnNjcmliZSxmcmVlIn0sImVzc2ItdGVtcGxhdGUtY2hyaXN0bWFzIjp7InNsdWciOiJlc3NiLXRlbXBsYXRlLWNocmlzdG1hcyIsIm5hbWUiOiJUZW1wbGF0ZXM6IENocmlzdG1hcyBwYWNrIiwiaW1hZ2UiOiJodHRwOlwvXC9hZGRvbnMuYXBwc2NyZW8uY29tXC9pXC9hZGRvbl9pbWFnZXMtdGVtcGxhdGUucG5nIiwiZGVzY3JpcHRpb24iOiJQcmVwYXJlIHlvdXIgc2l0ZSBmb3IgdXBjb21pbmcgQ2hyaXN0bWFzIGFuZCBOZXcgWWVhciB3aXRoIHR3byBzcGVjaWFsIENocmlzdG1hcyB0ZW1wbGF0ZXMiLCJwcmljZSI6IkZSRUUiLCJwYWdlIjoiaHR0cDpcL1wvZ2V0LnNvY2lhbHNoYXJpbmdwbHVnaW4uY29tXC8/ZG93bmxvYWQ9ZXNzYi10ZW1wbGF0ZS1jaHJpc3RtYXMiLCJkZW1vX3VybCI6IiIsImNoZWNrIjoiRVNTQl9URU1QTEFURVBBQ0tfQ0hSSVNUTUFTIiwidGFncyI6IiIsImNhdGVnb3J5IjoidGVtcGxhdGVzIiwicmVxdWlyZXMiOiI0LjAuMiIsImZpbHRlcnMiOiJ0ZW1wbGF0ZSxmcmVlIn0sImVzc2ItZGlzcGxheS13b29jb21tZXJjZWJhciI6eyJzbHVnIjoiZXNzYi1kaXNwbGF5LXdvb2NvbW1lcmNlYmFyIiwibmFtZSI6IkRpc3BsYXkgTWV0aG9kOiBXb29Db21tZXJjZSBCYXIiLCJpbWFnZSI6Imh0dHA6XC9cL2FkZG9ucy5hcHBzY3Jlby5jb21cL2lcL2FkZG9uX2ltYWdlcy1wb3NpdGlvbi5wbmciLCJkZXNjcmlwdGlvbiI6IlNwZWNpYWwgZGVzaWduZWQgc2hhcmUgYmFyIGZvciBXb29Db21tZXJjZSBzdG9yZXMgd2l0aCBzaGFlciBidXR0b25zLCBwcm9kdWN0IHRpdGxlXC9wcmljZSBhbmQgYnV5IG5vdyBidXR0b24iLCJwcmljZSI6IkZSRUUiLCJwYWdlIjoiaHR0cDpcL1wvZ2V0LnNvY2lhbHNoYXJpbmdwbHVnaW4uY29tXC8/ZG93bmxvYWQ9ZXNzYi1kaXNwbGF5LXdvb2NvbW1lcmNlYmFyIiwiZGVtb191cmwiOiIiLCJjaGVjayI6IkVTU0JfRE1fVlBfUExVR0lOX1VSTCIsInRhZ3MiOiIiLCJjYXRlZ29yeSI6ImRpc3BsYXkgbWV0aG9kIiwicmVxdWlyZXMiOiI0LjAuMiIsImZpbHRlcnMiOiJkaXNwbGF5LGZyZWUifSwiZXNzYi1kaXNwbGF5LXZpcmFscG9pbnQiOnsic2x1ZyI6ImVzc2ItZGlzcGxheS12aXJhbHBvaW50IiwibmFtZSI6IkRpc3BsYXkgTWV0aG9kOiBWaXJhbCBQb2ludCIsImltYWdlIjoiaHR0cDpcL1wvYWRkb25zLmFwcHNjcmVvLmNvbVwvaVwvYWRkb25faW1hZ2VzLXBvc2l0aW9uLnBuZyIsImRlc2NyaXB0aW9uIjoiU3VwZXIgY29vbCBzaGFyZSBwb2ludCBkZXNpZ24gd2l0aCBhdXRvbWF0aWMgdHJpZ2dlciBvbiBob3ZlciwgZXllIGNhdGNoaW5nIGRlc2lnbiBhbmQgYW5pbWF0aW9ucyIsInByaWNlIjoiRlJFRSIsInBhZ2UiOiJodHRwOlwvXC9nZXQuc29jaWFsc2hhcmluZ3BsdWdpbi5jb21cLz9kb3dubG9hZD1lc3NiLWRpc3BsYXktdmlyYWxwb2ludCIsImRlbW9fdXJsIjoiIiwiY2hlY2siOiJFU1NCX0RNX1ZQX1BMVUdJTl9VUkwiLCJ0YWdzIjoiIiwiY2F0ZWdvcnkiOiJkaXNwbGF5IG1ldGhvZCIsInJlcXVpcmVzIjoiNC4wLjIiLCJmaWx0ZXJzIjoiZGlzcGxheSxmcmVlIn0sImVzc2ItZGlzcGxheS1zdXBlcnBvc3RmbG9hdCI6eyJzbHVnIjoiZXNzYi1kaXNwbGF5LXN1cGVycG9zdGZsb2F0IiwibmFtZSI6IkRpc3BsYXkgTWV0aG9kOiBTdXBlciBQb3N0IEZsb2F0IiwiaW1hZ2UiOiJodHRwOlwvXC9hZGRvbnMuYXBwc2NyZW8uY29tXC9pXC9hZGRvbl9pbWFnZXMtcG9zaXRpb24ucG5nIiwiZGVzY3JpcHRpb24iOiJFeHRlbmRlZCB2ZXJzaW9uIG9mIHBvc3QgdmVydGljYWwgZmxvYXQgd2l0aCBjYWxsIHRvIGFjdGlvbiBtZXNzYWdlIGFuZCBkaXNwbGF5IG9mIHRvdGFsXC9jb21tZW50cyBjb3VudCIsInByaWNlIjoiRlJFRSIsInBhZ2UiOiJodHRwOlwvXC9nZXQuc29jaWFsc2hhcmluZ3BsdWdpbi5jb21cLz9kb3dubG9hZD1lc3NiLWRpc3BsYXktc3VwZXJwb3N0ZmxvYXQiLCJkZW1vX3VybCI6IiIsImNoZWNrIjoiRVNTQl9ETV9TUEZfUExVR0lOX1VSTCIsInRhZ3MiOiIiLCJjYXRlZ29yeSI6ImRpc3BsYXkgbWV0aG9kIiwicmVxdWlyZXMiOiI0LjAuMiIsImZpbHRlcnMiOiJkaXNwbGF5LGZyZWUifSwiZXNzYi1kaXNwbGF5LXN1cGVycG9zdGJhciI6eyJzbHVnIjoiZXNzYi1kaXNwbGF5LXN1cGVycG9zdGJhciIsIm5hbWUiOiJEaXNwbGF5IE1ldGhvZDogU3VwZXIgUG9zdCBCYXIiLCJpbWFnZSI6Imh0dHA6XC9cL2FkZG9ucy5hcHBzY3Jlby5jb21cL2lcL2FkZG9uX2ltYWdlcy1wb3NpdGlvbi5wbmciLCJkZXNjcmlwdGlvbiI6IkV4dGVuZCB5b3VyIGJvdHRvbSBkaXNwbGF5IG1ldGhvZCB3aXRoIHN1cGVyIHBvc3QgYmFyLiBTdXBlciBwb3N0IGJhciBhbGxvd3MgZGlzcGxheSBvZiBwcmV2aW91c1wvbmV4dCBwb3N0IHRvby4iLCJwcmljZSI6IkZSRUUiLCJwYWdlIjoiaHR0cDpcL1wvZ2V0LnNvY2lhbHNoYXJpbmdwbHVnaW4uY29tXC8/ZG93bmxvYWQ9ZXNzYi1kaXNwbGF5LXN1cGVycG9zdGJhciIsImRlbW9fdXJsIjoiIiwiY2hlY2siOiJFU1NCX0RNX1NQQl9QTFVHSU5fVVJMIiwidGFncyI6IiIsImNhdGVnb3J5IjoiZGlzcGxheSBtZXRob2QiLCJyZXF1aXJlcyI6IjQuMC4yIiwiZmlsdGVycyI6ImRpc3BsYXksZnJlZSJ9LCJlc3NiLWRpc3BsYXktbW9iaWxlLXNoYXJlYmFyY3RhIjp7InNsdWciOiJlc3NiLWRpc3BsYXktbW9iaWxlLXNoYXJlYmFyY3RhIiwibmFtZSI6IkRpc3BsYXkgTWV0aG9kOiBNb2JpbGUgU2hhcmUgQmFyIHdpdGggQ2FsbCB0byBBY3Rpb24gQnV0dG9uIiwiaW1hZ2UiOiJodHRwOlwvXC9hZGRvbnMuYXBwc2NyZW8uY29tXC9pXC9hZGRvbl9pbWFnZXMtcG9zaXRpb24ucG5nIiwiZGVzY3JpcHRpb24iOiJJbmNsdWRlIG1vYmlsZSBzaGFyZSBiYXIgd2l0aCBjdXN0b20gY2FsbCB0byBhY3Rpb24gYnV0dG9uIG5leHQgdG8gc2hhcmUgYnV0dG9uLiIsInByaWNlIjoiRlJFRSIsInBhZ2UiOiJodHRwOlwvXC9nZXQuc29jaWFsc2hhcmluZ3BsdWdpbi5jb21cLz9kb3dubG9hZD1lc3NiLWRpc3BsYXktbW9iaWxlLXNoYXJlYmFyY3RhIiwiZGVtb191cmwiOiIiLCJjaGVjayI6IkVTU0JfRE1fTVNCQ1RBX1BMVUdJTl9VUkwiLCJ0YWdzIjoiIiwiY2F0ZWdvcnkiOiJkaXNwbGF5IG1ldGhvZCIsInJlcXVpcmVzIjoiNC4wLjIiLCJmaWx0ZXJzIjoiZGlzcGxheSxmcmVlIn0sImVzc2Itc3Vic2NyaWJlLWNvbm5lY3Rvci1qZXRwYWNrIjp7InNsdWciOiJlc3NiLXN1YnNjcmliZS1jb25uZWN0b3ItamV0cGFjayIsIm5hbWUiOiJPcHQtaW4gQ29ubmVjdG9yOiBKZXRQYWNrIFN1YnNjcmlwdGlvbnMiLCJpbWFnZSI6Imh0dHA6XC9cL2FkZG9ucy5hcHBzY3Jlby5jb21cL2lcL2FkZG9uX2ltYWdlcy1zdWJzY3JpYmUucG5nIiwiZGVzY3JpcHRpb24iOiJBY3RpdmF0ZSB1c2FnZSBvZiBKZXRQYWNrIFN1YnNjcmlwdGlvbnMgaW4gT3B0LWluIE1vZHVsZSIsInByaWNlIjoiRlJFRSIsInBhZ2UiOiJodHRwOlwvXC9nZXQuc29jaWFsc2hhcmluZ3BsdWdpbi5jb21cLz9kb3dubG9hZD1lc3NiLXN1YnNjcmliZS1jb25uZWN0b3ItamV0cGFjayIsImRlbW9fdXJsIjoiIiwiY2hlY2siOiJFU1NCX1NVQlNDUklCRV9DT05ORUNUT1JfSkVUUEFDSyIsInRhZ3MiOiIiLCJjYXRlZ29yeSI6InN1YnNjcmliZSBjb25uZWN0b3IiLCJyZXF1aXJlcyI6IjQuMC4yIiwiZmlsdGVycyI6InN1YnNjcmliZSxmcmVlIn0sImVzc2Itc29jaWFsLWFiIjp7InNsdWciOiJlc3NiLXNvY2lhbC1hYiIsIm5hbWUiOiJTb2NpYWwgQVwvQiBWaXN1YWwgVGVzdHMgQWRkLW9uIGZvciBFYXN5IFNvY2lhbCBTaGFyZSBCdXR0b25zIiwiaW1hZ2UiOiJodHRwOlwvXC9hZGRvbnMuYXBwc2NyZW8uY29tXC9pXC9hZGRvbl9pbWFnZXM0LTA3LnBuZyIsImRlc2NyaXB0aW9uIjoiSXQgd2FzIG5ldmVyIGJlZW4gc28gZWFzeSB0byBmaW5kIHdoYXQgd29ya3MgYmVzdCBmb3IgeW91ciBzaXRlLiBTZXR1cCB1cCB0byAzIGRpZmZlcmVudCBjb25maWd1cmF0aW9ucyBvZiBidXR0b25zIG9uIHlvdXIgc2l0ZSBhbmQgcnVuIHRoZSB0ZXN0cy4gWW91IHdpbGwgc2VlIHJlYWwgdGltZSBzdGF0cyBvZiB3aGF0IHBlcmZvcm1zIGJlc3QuIiwicHJpY2UiOiJGUkVFIiwicGFnZSI6Imh0dHA6XC9cL2dldC5zb2NpYWxzaGFyaW5ncGx1Z2luLmNvbVwvP2Rvd25sb2FkPWVzc2Itc29jaWFsLWFiIiwiZGVtb191cmwiOiJodHRwOlwvXC9zb2NpYWxzaGFyaW5ncGx1Z2luLmNvbVwvc29jaWFsLWFiXC8iLCJjaGVjayI6IkVTU0IzX0FCX1ZFUlNJT04iLCJ0YWdzIjoidW5pcXVlIiwiY2F0ZWdvcnkiOiJhbmFseXRpY3MiLCJyZXF1aXJlcyI6IjQuMCIsImZpbHRlcnMiOiJmdW5jdGlvbixmcmVlIn0sImVzc2ItcG9zdC12aWV3cyI6eyJzbHVnIjoiZXNzYi1wb3N0LXZpZXdzIiwibmFtZSI6IlBvc3QgVmlld3MgQWRkLW9uIGZvciBFYXN5IFNvY2lhbCBTaGFyZSBCdXR0b25zIiwiaW1hZ2UiOiJodHRwOlwvXC9hZGRvbnMuYXBwc2NyZW8uY29tXC9pXC9hZGRvbl9pbWFnZXM0LTAyLnBuZyIsImRlc2NyaXB0aW9uIjoiVHJhY2sgYW5kIGRpc3BsYXkgcG9zdCB2aWV3c1wvcmVhZHMgd2l0aCB5b3VyIHNoYXJlIGJ1dHRvbnMgYW5kIGFsc28gZGlzcGxheSBtb3N0IHBvcHVsYXIgcG9zdHMgd2l0aCB3aWRnZXQgb3Igc2hvcnRjb2RlLiIsInByaWNlIjoiRlJFRSIsInBhZ2UiOiJodHRwOlwvXC9nZXQuc29jaWFsc2hhcmluZ3BsdWdpbi5jb21cLz9kb3dubG9hZD1lc3NiLXBvc3Qtdmlld3MiLCJkZW1vX3VybCI6Imh0dHA6XC9cL3NvY2lhbHNoYXJpbmdwbHVnaW4uY29tXC92aWV3c3JlYWRzLWNvdW50ZXJcLyIsInRhZ3MiOiJwb3B1bGFyIiwiY2hlY2siOiJFU1NCM19QVl9WRVJTSU9OIiwiY2F0ZWdvcnkiOiJmZWF0dXJlIiwicmVxdWlyZXMiOiIzLjAiLCJmaWx0ZXJzIjoiZnVjdGlvbixmcmVlIn0sImVzc2ItZmFjZWJvb2stY29tbWVudHMiOnsic2x1ZyI6ImVzc2ItZmFjZWJvb2stY29tbWVudHMiLCJuYW1lIjoiRmFjZWJvb2sgQ29tbWVudHMgQWRkLW9uIGZvciBFYXN5IFNvY2lhbCBTaGFyZSBCdXR0b25zIiwiaW1hZ2UiOiJodHRwOlwvXC9hZGRvbnMuYXBwc2NyZW8uY29tXC9pXC9hZGRvbl9pbWFnZXM0LTA0LnBuZyIsImRlc2NyaXB0aW9uIjoiQXV0b21hdGljYWxseSBpbmNsdWRlIEZhY2Vib29rIGNvbW1lbnRzIHRvIHlvdXIgYmxvZyB3aXRoIG1vZGVyYXRpb24gb3B0aW9uIGJlbG93IHBvc3RzIiwicHJpY2UiOiJGUkVFIiwicGFnZSI6Imh0dHA6XC9cL2dldC5zb2NpYWxzaGFyaW5ncGx1Z2luLmNvbVwvP2Rvd25sb2FkPWVzc2ItZmFjZWJvb2stY29tbWVudHMiLCJkZW1vX3VybCI6Imh0dHA6XC9cL3NvY2lhbHNoYXJpbmdwbHVnaW4uY29tXC9mYWNlYm9vay1jb21tZW50c1wvP2ZiY29tbWVudHNfZGVtbz10cnVlIiwiY2hlY2siOiJFU1NCM19GQ19WRVJTSU9OIiwidGFncyI6InBvcHVsYXIiLCJjYXRlZ29yeSI6ImZlYXR1cmUiLCJyZXF1aXJlcyI6IjMuMCIsImZpbHRlcnMiOiJmdW5jdGlvbixmcmVlIn0sImVzc2ItYW1wLXN1cHBvcnQiOnsic2x1ZyI6ImVzc2ItYW1wLXN1cHBvcnQiLCJuYW1lIjoiQU1QIFNoYXJlIEJ1dHRvbnMgQWRkLW9uIGZvciBFYXN5IFNvY2lhbCBTaGFyZSBCdXR0b25zIiwiaW1hZ2UiOiJodHRwOlwvXC9hZGRvbnMuYXBwc2NyZW8uY29tXC9pXC9hZGRvbl9pbWFnZXM0LTAzLnBuZyIsImRlc2NyaXB0aW9uIjoiSW5jbHVkZSBzaGFyZSBidXR0b25zIG9uIHlvdXIgQU1QIHBhZ2VzIGlmIHlvdSB1c2Ugb2ZmaWNpYWwgcGx1Z2luIFdvcmRQcmVzcyBBTVAiLCJwcmljZSI6IkZSRUUiLCJwYWdlIjoiaHR0cDpcL1wvZ2V0LnNvY2lhbHNoYXJpbmdwbHVnaW4uY29tXC8/ZG93bmxvYWQ9ZXNzYi1hbXAtc3VwcG9ydCIsImRlbW9fdXJsIjoiIiwiY2hlY2siOiJFU1NCM19BTVBfUExVR0lOX1JPT1QiLCJ0YWdzIjoidXBkYXRlZCIsImNhdGVnb3J5IjoibW9iaWxlIiwicmVxdWlyZXMiOiI0LjAiLCJmaWx0ZXJzIjoiZnVuY3Rpb24sZnJlZSJ9LCJlc3NiLW9wdGluLWNvbnRlbnQiOnsic2x1ZyI6ImVzc2Itb3B0aW4tY29udGVudCIsIm5hbWUiOiJPcHQtaW4gRm9ybXMgQmVsb3cgQ29udGVudCBBZGQtb24gZm9yIEVhc3kgU29jaWFsIFNoYXJlIEJ1dHRvbnMiLCJpbWFnZSI6Imh0dHA6XC9cL2FkZG9ucy5hcHBzY3Jlby5jb21cL2lcL2FkZG9uX2ltYWdlczQtMDYucG5nIiwiZGVzY3JpcHRpb24iOiJBdXRvbWF0aWNhbGx5IGluY2x1ZGUgb3B0LWluIGZvcm1zIGZyb20gRWFzeSBPcHRpbiBiZWxvdyBwb3N0IGNvbnRlbnQuIEVhc3kgZ2V0IG1vcmUgbmV3IHN1YnNjcmliZXJzIHRvIHlvdXIgbWFpbGluZyBsaXN0LiIsInByaWNlIjoiRlJFRSIsInBhZ2UiOiJodHRwOlwvXC9nZXQuc29jaWFsc2hhcmluZ3BsdWdpbi5jb21cLz9kb3dubG9hZD1lc3NiLW9wdGluLWNvbnRlbnQiLCJkZW1vX3VybCI6Imh0dHA6XC9cL3NvY2lhbHNoYXJpbmdwbHVnaW4uY29tXC9lYXN5LW9wdGluXC8iLCJjaGVjayI6IkVTU0IzX09GX1ZFUlNJT04iLCJ0YWdzIjoiIiwiY2F0ZWdvcnkiOiJmZWF0dXJlIiwicmVxdWlyZXMiOiI0LjAiLCJmaWx0ZXJzIjoic3Vic2NyaWJlLGZyZWUifSwiaGVsbG8tZm9sbG93ZXJzIjp7InNsdWciOiJoZWxsby1mb2xsb3dlcnMiLCJuYW1lIjoiSGVsbG8gRm9sbG93ZXJzIC0gU29jaWFsIENvdW50ZXIgUGx1Z2luIiwiaW1hZ2UiOiJodHRwOlwvXC9hZGRvbnMuYXBwc2NyZW8uY29tXC9pXC9hZGRvbl9pbWFnZXM0LTA1LnBuZyIsImRlc2NyaXB0aW9uIjoiQmVhdGlmdWwgYW5kIHVuaXF1ZSBleHRlbnNpb24gb2YgeW91ciBjdXJyZW50IHNvY2lhbCBmb2xsb3dlcnMgd2l0aCBjb3ZlciBib3hlcywgbGF5b3V0IGJ1aWxkZXIsIGFkdmFuY2VkIGN1c3RvbWl6ZXIsIHByb2ZpbGUgYW5hbHl0aWNzLiBUcnkgdGhlIGxpdmUgZGVtbyB0byB0ZXN0LiIsInByaWNlIjoiJDI0IiwicGFnZSI6Imh0dHA6XC9cL2NvZGVjYW55b24ubmV0XC9pdGVtXC9oZWxsby1mb2xsb3dlcnMtc29jaWFsLWNvdW50ZXItcGx1Z2luLWZvci13b3JkcHJlc3NcLzE1ODAxNzI5IiwiZGVtb191cmwiOiJodHRwOlwvXC9jb2RlY2FueW9uLm5ldFwvaXRlbVwvaGVsbG8tZm9sbG93ZXJzLXNvY2lhbC1jb3VudGVyLXBsdWdpbi1mb3Itd29yZHByZXNzXC9mdWxsX3NjcmVlbl9wcmV2aWV3XC8xNTgwMTcyOSIsImNoZWNrIjoiSEZfVkVSU0lPTiIsImNhdGVnb3J5IjoicGFpZCIsInJlcXVpcmVzIjoiMS4wIiwiZmlsdGVycyI6InBhaWQifSwiZXNzYi1zZWxmLXNob3J0LXVybCI6eyJzbHVnIjoiZXNzYi1zZWxmLXNob3J0LXVybCIsIm5hbWUiOiJTZWxmLUhvc3RlZCBTaG9ydCBVUkxzIGFkZC1vbiBmb3IgRWFzeSBTb2NpYWwgU2hhcmUgQnV0dG9ucyIsImltYWdlIjoiaHR0cDpcL1wvYWRkb25zLmFwcHNjcmVvLmNvbVwvaVwvYWRkb25faW1hZ2VzNC0wMS5wbmciLCJkZXNjcmlwdGlvbiI6IkdlbmVyYXRlIHNlbGYgaG9zdGVkIHNob3J0IFVSTHMgZGlyZWN0bHkgZnJvbSB5b3VyIFdvcmRQcmVzcyB3aXRob3V0IGV4dGVybmFsIHNlcnZpY2VzIGxpa2UgaHR0cDpcL1wvZG9tYWluLmNvbVwvYXhXc2Egb3IgY3VzdG9tIGJhc2VkIGh0dHA6XC9cL2RvbWFpbi5jb21cL2Vzc2IuIiwicHJpY2UiOiIkMTQiLCJwYWdlIjoiaHR0cDpcL1wvY29kZWNhbnlvbi5uZXRcL2l0ZW1cL3NlbGYtaG9zdGVkLXNob3J0LXVybHMtYWRkb24tZm9yLWVhc3ktc29jaWFsLXNoYXJlLWJ1dHRvbnNcLzE1MDY2NDQ3IiwiZGVtb191cmwiOiJodHRwOlwvXC9jb2RlY2FueW9uLm5ldFwvaXRlbVwvc2VsZi1ob3N0ZWQtc2hvcnQtdXJscy1hZGRvbi1mb3ItZWFzeS1zb2NpYWwtc2hhcmUtYnV0dG9uc1wvZnVsbF9zY3JlZW5fcHJldmlld1wvMTUwNjY0NDciLCJjaGVjayI6IkVTU0IzX1NTVV9WRVJTSU9OIiwiY2F0ZWdvcnkiOiJwYWlkIiwicmVxdWlyZXMiOiIzLjEuMiIsImZpbHRlcnMiOiJmdW5jdGlvbixwYWlkIn0sImZpbHRlcnMiOnsiYWxsIjoiQWxsIiwibmV3IjoiTmV3IiwiZnJlZSI6IkZyZWUiLCJuZXR3b3JrcyI6Ik5ldHdvcmtzIiwiZGlzcGxheSI6IkRpc3BsYXkgTWV0aG9kcyIsInRlbXBsYXRlIjoiVGVtcGxhdGVzIiwic3Vic2NyaWJlIjoiT3B0LWluIEFkZC1vbnMiLCJ2aWRlbyI6IlZpZGVvIFNoYXJpbmciLCJmdW5jdGlvbiI6IkZ1bmN0aW9ucyIsInBhaWQiOiJQYWlkIn19';
	private $base_addons_data;

	private static $instance = null;
	public static function get_instance() {

		if ( null == self::$instance ) {
			self::$instance = new self;
		}

		return self::$instance;

	} // end get_instance;

	function __construct() {
		$remote_result = base64_decode ( $this->base_addons );
		
		$remote_result = htmlspecialchars_decode ( $remote_result );
		$remote_result = stripslashes ( $remote_result );
		$info = json_decode($remote_result, true);
		if (is_array($info)) {
			//update_option($this->cache_options_slug, $info);
			$this->base_addons_data = $info;
		}
	}


	public function call_remove_addon_list_update() {		
		$url = $this->update_addons_server;
		$result = wp_remote_get($url);
		$success_connection = true;

		if(is_wp_error($result) or (wp_remote_retrieve_response_code($result) != 200)){
			$success_connection = false;
		}
			
		/* Check for incorrect data */
		if ($success_connection) {
			$remote_result = wp_remote_retrieve_body($result);
			$remote_result = base64_decode ( $remote_result );
		
			$remote_result = htmlspecialchars_decode ( $remote_result );
			$remote_result = stripslashes ( $remote_result );						
			
			$info = json_decode($remote_result, true);
			if (is_array($info)) {
				update_option($this->cache_options_slug, $info);
			}
		}
	}

	public function get_addons() {
		$addons = get_option($this->cache_options_slug);

		if (!$addons) {
			$addons = $this->base_addons_data;
		}
		
		if (!is_array($addons)) {
			$addons = array();
		}
		
		return $addons;
	}

	public function get_new_addons() {
		/*if (false === get_transient($this->cache_options_slug)) {
			$this->call_remove_addon_list_update();
			delete_transient($this->cache_options_slug);
			set_transient( $this->cache_options_slug, 'updated', 168 * HOUR_IN_SECONDS );
		}*/

		$addons = $this->get_addons();

		if (!is_array($addons)) {
			$addons = array();
		}

		$current_announced = get_option($this->announced_addons_slug);
		if (!is_array($current_announced)) {
			$current_announced = array();
		}

		$list_of_new = array();
		foreach ($addons as $addon_key => $addon_data) {
			if ($addon_key == "filters") continue;
			if (!isset($current_announced[$addon_key])) {
				$list_of_new[$addon_key] = array("title" => $addon_data['name'], "url" => $addon_data['page']);
			}
		}


		return $list_of_new;
	}

	public function get_new_addons_count() {
		/*if (false === get_transient($this->cache_options_slug)) {
			$this->call_remove_addon_list_update();
			delete_transient($this->cache_options_slug);
			set_transient( $this->cache_options_slug, 'updated', 168 * HOUR_IN_SECONDS );
		}*/

		$addons = $this->get_addons();

		if (!is_array($addons)) {
			$addons = array();
		}

		$current_announced = get_option($this->announced_addons_slug);
		if (!is_array($current_announced)) {
			$current_announced = array();
		}

		$list_of_new = 0;
		foreach ($addons as $addon_key => $addon_data) {
			if ($addon_key == "filters") continue;
			if (!isset($current_announced[$addon_key])) {
				$list_of_new++;
			}
		}


		return $list_of_new;
	}

	public function dismiss_addon_notice($addon) {
		$current_announced = get_option($this->announced_addons_slug);
		if (!is_array($current_announced)) {
			$current_announced = array();
		}

		if (strpos($addon, ',') == false) {
			$current_announced[$addon] = "yes";
		}
		else {
			$addon_list = explode(',', $addon);
			foreach ($addon_list as $one) {
				$current_announced[$one] = "yes";
			}
		}

		update_option($this->announced_addons_slug, $current_announced);
	}
}

?>